# å·¥ç¨‹ç®€ä»‹

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºSpringBootåµŒå¥—å®¹å™¨å¯åŠ¨keycloak-serviceçš„ç¤ºä¾‹Demoï¼ŒDemoæ¼”ç¤ºäº†ä»¥ä¸‹å†…å®¹

- è‡ªå®šä¹‰é¡µé¢
- è‡ªå®šä¹‰å›½é™…åŒ–å†…å®¹
- è‡ªå®šä¹‰ç™»å½•æ–¹å¼
    - ä¼ä¸šå¾®ä¿¡ç™»å½•ï¼ˆå¾…å®šï¼‰

### ç¯å¢ƒç‰ˆæœ¬

- keycloak : 18.0
- springboot: 2.6.7
- JDKï¼š11

### å¿«é€Ÿå¼€å§‹

- å¯åŠ¨é¡¹ç›®åï¼Œç›´æ¥æ‰“å¼€ğŸ”— [http://localhost:8080/auth/](http://localhost:8080/auth/)
- ç‚¹å‡»Administration Console è¿›å…¥æ§åˆ¶å°
- ç™»å½•å/å¯†ç ï¼šadmin/admin
    - è¶…çº§ç®¡ç†å‘˜è´¦å·å¯†ç å¯ä»¥åœ¨application.yml ä¸­çš„ adminUser å±æ€§è®¾ç½®

# å»¶ä¼¸é˜…è¯»

### ä¸€ã€å¦‚ä½•è‡ªå®šä¹‰Keycloakç™»å½•é¡µé¢ï¼Ÿ

**åœ¨äº†è§£å¦‚ä½•è‡ªå®šä¹‰Keycloakç™»å½•é¡µé¢å‰ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹keycloakè‡ªå®šä¹‰é¡µé¢çš„åŸç†ã€‚**

keycloakæä¾›äº†ç½‘é¡µçš„ä¸»é¢˜æ”¯æŒï¼Œå¹¶ä¸”å…è®¸ç”¨æˆ·æŒ‰ç…§è‡ªå·±éœ€æ±‚è‡ªå®šä¹‰ä¸»é¢˜ã€‚
å®ƒå¯ä»¥æ”¯æŒä»¥ä¸‹å‡ ä¸ªæ¨¡å—çš„ä¸»é¢˜è‡ªå®šä¹‰ï¼š
- è´¦æˆ·ç®¡ç†æ¨¡å—
- ç®¡ç†æ§åˆ¶å°æ¨¡å—
- ç™»å½•è¡¨å•
- æ¬¢è¿é¡µé¢

ä¸€ä¸ªä¸»é¢˜é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªå†…å®¹ï¼š
- HTML templates (Freemarker Templates)
- Imagesï¼ˆé¡µé¢éœ€è¦çš„å›¾ç‰‡ï¼‰
- Message bundlesï¼ˆå›½é™…åŒ–å†…å®¹ï¼‰
- Stylesheetsï¼ˆcssæ ·å¼ï¼‰
- Scriptsï¼ˆjs è„šæœ¬ï¼‰
- Theme propertiesï¼ˆä¸»é¢˜è®¾ç½®ï¼‰

åœ¨resourcesçš„ç›®å½•å¦‚ä¸‹

```
resources
â””â”€â”€ theme
    â””â”€â”€ mytheme                                 // è‡ªå®šä¹‰ä¸»é¢˜åç§°ï¼Œå¯ä»¥è‡ªå·±å–
        â””â”€â”€ login                               // ç™»å½•æ¨¡å—ï¼Œå‚è€ƒå®˜æ–¹æºç æˆ–è€…æ–‡æ¡£
            â”œâ”€â”€ login.ftl                       // è‡ªå®šä¹‰ç™»å½•é¡µé¢çš„å†…å®¹
            â”œâ”€â”€ messages                        // å›½é™…åŒ–çš„æ¶ˆæ¯åŒ…
            â”‚Â Â  â””â”€â”€ messages_zh_CN.properties   // ç”¨æˆ·è‡ªå®šä¹‰çš„å›½é™…åŒ–æ¶ˆæ¯   
            â”œâ”€â”€ resources
            â”‚Â Â  â”œâ”€â”€ css                         // ç”¨æˆ·è‡ªå®šä¹‰çš„css
            â”‚Â Â  â”‚Â Â  â””â”€â”€ mylogin.css
            â”‚Â Â  â”œâ”€â”€ img                         // ç”¨æˆ·è‡ªå®šä¹‰çš„å›¾ç‰‡
            â”‚Â Â  â”‚Â Â  â””â”€â”€ login-bg.jpg
            â”‚Â Â  â””â”€â”€ js                          // ç”¨æˆ·è‡ªå®šä¹‰çš„js
            â”‚Â Â      â””â”€â”€ script.js
            â””â”€â”€ theme.properties                // ä¸»é¢˜è®¾ç½®ï¼Œå®ƒå¯ä»¥å¯¼å…¥ä¸€äº›å…¬å…±èµ„æºï¼ˆjs,cssï¼Œfreemarkerçš„å‚æ•°ç­‰ï¼‰ï¼Œæä¾›ç»™é¡µé¢ä½¿ç”¨

```

å½“æˆ‘ä»¬æŒ‰ç…§ä¸Šè¿°ç›®å½•çš„æ ¼å¼ï¼Œå°†è‡ªå·±çš„è‡ªå®šä¹‰é¡µé¢æ·»åŠ å¥½åï¼Œæˆ‘ä»¬éœ€è¦æ‰“å¼€Administration Console è¿›å…¥æ§åˆ¶å°ï¼Œ

- é€‰æ‹©Realm Settings -> Themes ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ç”¨æˆ·è‡ªå®šä¹‰ä¸»é¢˜mythemeï¼Œé€‰ä¸­åä¿å­˜ï¼Œåˆ·æ–°é¡µé¢åï¼Œæ‰“å¼€keycloakçš„ç™»å½•é¡µé¢æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ç”¨æˆ·è‡ªå®šä¹‰çš„é¡µé¢å•¦ã€‚ã€‚ã€‚

![](assets/16601909324241.jpg)



### äºŒã€å¦‚ä½•è‡ªå®šä¹‰å›½é™…åŒ–å†…å®¹ï¼Ÿ

**keycloak é»˜è®¤æ˜¯æ”¯æŒä¸­æ–‡æ±‰åŒ–ï¼Œä½†æ±‰åŒ–çš„å¹¶ä¸é½å…¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Realm Settings -> Themeï¼Œè®¾ç½®Internationalization Enabled ä¸ºtrue å¼€å¯å›½é™…åŒ–ï¼Œè®¾ç½®Supported Locales é€‰æ‹©æˆ‘ä»¬éœ€è¦çš„è¯­è¨€ã€‚**

- æˆ‘ä»¬ä»¥ä¸­æ–‡æ±‰åŒ–ä¸ºä¾‹ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨messagesç›®å½•ä¸‹åŠ å…¥messages_zh_CN.propertiesæ–‡ä»¶ï¼Œå¹¶ä¸”è®¾ç½®å›½é™…åŒ–çš„å†…å®¹ã€‚

```
# encoding: utf-8
loginAccountTitle=ç™»å½•æ‚¨çš„å¸æˆ·
```

- æ›´æ”¹å®Œæˆï¼Œé‡å¯é¡¹ç›®åï¼Œæˆ‘ä»¬å°†Supported Locales è®¾ç½®ä¸ºzhå°±èƒ½çœ‹åˆ°è‡ªå·±æ±‰åŒ–çš„å†…å®¹äº†ã€‚

![](assets/16601922260600.jpg)


- messages_zh_CN.properties çš„è‡ªå®šä¹‰å±æ€§ï¼Œæˆ‘æ˜¯å‚è€ƒ[keycloakæºç ](https://github.com/keycloak/keycloak.git) ä¸­`/themes/src/main/resources-community/theme/base/login/messages/messages_zh_CN.properties`æ–‡ä»¶ã€‚
- å½“ç„¶æƒ³é€‚é…å…¶ä»–çš„è¯­è¨€ï¼Œå¤„ç†çš„é€»è¾‘ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚




# å‚è€ƒæ–‡çŒ®ï¼š

- [å®˜æ–¹æ–‡æ¡£ - keycloakè‡ªå®šä¹‰ä¸»é¢˜](https://www.keycloak.org/docs/18.0/server_development/index.html#_themes)
- [embedded-keycloak-server-custom](https://github.com/thomasdarimont/embedded-spring-boot-keycloak-server/tree/master/embedded-keycloak-server-custom)
